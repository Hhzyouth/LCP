import{D as buildProps,aN as iconPropType,G as definePropType,d as defineComponent,aY as useGlobalComponentSettings,t as ref,e as computed,aZ as TypeComponentsMap,O as onMounted,a_ as useEventListener,o as openBlock,j as createBlock,k as withCtx,a6 as withDirectives,p as createBaseVNode,n as normalizeClass,a7 as unref,a8 as normalizeStyle,E as ElIcon,aO as resolveDynamicComponent,g as createCommentVNode,y as toDisplayString,ai as renderSlot,f as createElementBlock,F as Fragment,ah as vShow,w as withModifiers,m as createVNode,aJ as Transition,_ as _export_sfc,a$ as CloseComponents,b0 as useTimeoutFn,S as EVENT_CODE,Q as isClient,aH as isVNode,b1 as isElement,aF as isString,b2 as render,b3 as withInstallFunction,al as _export_sfc$1,an as useRouter,az as useRoute,am as useUserStore,h,b4 as getBaseInfo,r as resolveComponent,ad as withKeys,ao as ElContainer,x as createTextVNode,v as renderList,at as ElButton,aq as ElHeader,a9 as ElInput,as as ElMain,aV as arrow_left_bold_default,aW as full_screen_default,aX as arrow_down_bold_default,au as pushScopeId,av as popScopeId}from"./index-BXCC11IL.js";import{v as vLoading}from"./el-loading-eh5KfxWa.js";import"./el-tag-YOrmE4kc.js";import{E as ElSelect,a as ElOption}from"./el-select-Bn9seCgH.js";import{E as ElScrollbar}from"./el-scrollbar-NpxurtvA.js";import{E as ElTabPane,a as ElTabs}from"./el-tab-pane-9eQCgsm8.js";import{p as python,c as cpp,j as java,g as go,b as getProblemContent,a as confetti,r as run,s as se}from"./confetti.module--Y_JIF_Y.js";import{u as useSocketStore,a as useCompetitionStore,b as add}from"./competition-BRttNCWD.js";import{E as ElMessageBox}from"./el-message-box-BGRsEgrk.js";import"./el-overlay-f9f6fV6x.js";/* empty css                   */import{E as ElMessage}from"./index-e590A-XK.js";import"./strings-CBtOi6BX.js";import"./isEqual-W0GA-HSG.js";import"./_Uint8Array-KkRCjyoh.js";import"./debounce-DY7VrZO3.js";import"./castArray-BxmzwEdl.js";import"./index-DW1qeJdV.js";import"./validator-tQ-UPy4o.js";import"./index-B1Dr4CYL.js";const notificationTypes=["success","info","warning","error"],notificationProps=buildProps({customClass:{type:String,default:""},dangerouslyUseHTMLString:{type:Boolean,default:!1},duration:{type:Number,default:4500},icon:{type:iconPropType},id:{type:String,default:""},message:{type:definePropType([String,Object]),default:""},offset:{type:Number,default:0},onClick:{type:definePropType(Function),default:()=>{}},onClose:{type:definePropType(Function),required:!0},position:{type:String,values:["top-right","top-left","bottom-right","bottom-left"],default:"top-right"},showClose:{type:Boolean,default:!0},title:{type:String,default:""},type:{type:String,values:[...notificationTypes,""],default:""},zIndex:Number}),notificationEmits={destroy:()=>!0},_hoisted_1$1=["id"],_hoisted_2$1=["textContent"],_hoisted_3$1={key:0},_hoisted_4$1=["innerHTML"],__default__=defineComponent({name:"ElNotification"}),_sfc_main$1=defineComponent({...__default__,props:notificationProps,emits:notificationEmits,setup(e,{expose:o}){const n=e,{ns:a,zIndex:c}=useGlobalComponentSettings("notification"),{nextZIndex:m,currentZIndex:v}=c,{Close:d}=CloseComponents,u=ref(!1);let i;const p=computed(()=>{const s=n.type;return s&&TypeComponentsMap[n.type]?a.m(s):""}),f=computed(()=>n.type&&TypeComponentsMap[n.type]||n.icon),g=computed(()=>n.position.endsWith("right")?"right":"left"),y=computed(()=>n.position.startsWith("top")?"top":"bottom"),b=computed(()=>{var s;return{[y.value]:`${n.offset}px`,zIndex:(s=n.zIndex)!=null?s:v.value}});function l(){n.duration>0&&({stop:i}=useTimeoutFn(()=>{u.value&&C()},n.duration))}function V(){i==null||i()}function C(){u.value=!1}function N({code:s}){s===EVENT_CODE.delete||s===EVENT_CODE.backspace?V():s===EVENT_CODE.esc?u.value&&C():l()}return onMounted(()=>{l(),m(),u.value=!0}),useEventListener(document,"keydown",N),o({visible:u,close:C}),(s,_)=>(openBlock(),createBlock(Transition,{name:unref(a).b("fade"),onBeforeLeave:s.onClose,onAfterLeave:_[1]||(_[1]=B=>s.$emit("destroy")),persisted:""},{default:withCtx(()=>[withDirectives(createBaseVNode("div",{id:s.id,class:normalizeClass([unref(a).b(),s.customClass,unref(g)]),style:normalizeStyle(unref(b)),role:"alert",onMouseenter:V,onMouseleave:l,onClick:_[0]||(_[0]=(...B)=>s.onClick&&s.onClick(...B))},[unref(f)?(openBlock(),createBlock(unref(ElIcon),{key:0,class:normalizeClass([unref(a).e("icon"),unref(p)])},{default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(unref(f))))]),_:1},8,["class"])):createCommentVNode("v-if",!0),createBaseVNode("div",{class:normalizeClass(unref(a).e("group"))},[createBaseVNode("h2",{class:normalizeClass(unref(a).e("title")),textContent:toDisplayString(s.title)},null,10,_hoisted_2$1),withDirectives(createBaseVNode("div",{class:normalizeClass(unref(a).e("content")),style:normalizeStyle(s.title?void 0:{margin:0})},[renderSlot(s.$slots,"default",{},()=>[s.dangerouslyUseHTMLString?(openBlock(),createElementBlock(Fragment,{key:1},[createCommentVNode(" Caution here, message could've been compromised, never use user's input as message "),createBaseVNode("p",{innerHTML:s.message},null,8,_hoisted_4$1)],2112)):(openBlock(),createElementBlock("p",_hoisted_3$1,toDisplayString(s.message),1))])],6),[[vShow,s.message]]),s.showClose?(openBlock(),createBlock(unref(ElIcon),{key:0,class:normalizeClass(unref(a).e("closeBtn")),onClick:withModifiers(C,["stop"])},{default:withCtx(()=>[createVNode(unref(d))]),_:1},8,["class","onClick"])):createCommentVNode("v-if",!0)],2)],46,_hoisted_1$1),[[vShow,u.value]])]),_:3},8,["name","onBeforeLeave"]))}});var NotificationConstructor=_export_sfc(_sfc_main$1,[["__file","notification.vue"]]);const notifications={"top-left":[],"top-right":[],"bottom-left":[],"bottom-right":[]},GAP_SIZE=16;let seed=1;const notify=function(e={},o=null){if(!isClient)return{close:()=>{}};(typeof e=="string"||isVNode(e))&&(e={message:e});const n=e.position||"top-right";let a=e.offset||0;notifications[n].forEach(({vm:p})=>{var f;a+=(((f=p.el)==null?void 0:f.offsetHeight)||0)+GAP_SIZE}),a+=GAP_SIZE;const c=`notification_${seed++}`,m=e.onClose,v={...e,offset:a,id:c,onClose:()=>{close(c,n,m)}};let d=document.body;isElement(e.appendTo)?d=e.appendTo:isString(e.appendTo)&&(d=document.querySelector(e.appendTo)),isElement(d)||(d=document.body);const u=document.createElement("div"),i=createVNode(NotificationConstructor,v,isVNode(v.message)?{default:()=>v.message}:null);return i.appContext=o??notify._context,i.props.onDestroy=()=>{render(null,u)},render(i,u),notifications[n].push({vm:i}),d.appendChild(u.firstElementChild),{close:()=>{i.component.exposed.visible.value=!1}}};notificationTypes.forEach(e=>{notify[e]=(o={})=>((typeof o=="string"||isVNode(o))&&(o={message:o}),notify({...o,type:e}))});function close(e,o,n){const a=notifications[o],c=a.findIndex(({vm:i})=>{var p;return((p=i.component)==null?void 0:p.props.id)===e});if(c===-1)return;const{vm:m}=a[c];if(!m)return;n==null||n(m);const v=m.el.offsetHeight,d=o.split("-")[0];a.splice(c,1);const u=a.length;if(!(u<1))for(let i=c;i<u;i++){const{el:p,component:f}=a[i].vm,g=Number.parseInt(p.style[d],10)-v-GAP_SIZE;f.props.offset=g}}function closeAll(){for(const e of Object.values(notifications))e.forEach(({vm:o})=>{o.component.exposed.visible.value=!1})}notify.closeAll=closeAll;notify._context=null;const ElNotification=withInstallFunction(notify,"$notify"),_withScopeId=e=>(pushScopeId("data-v-a31b1f23"),e=e(),popScopeId(),e),_hoisted_1=["onKeydown"],_hoisted_2=["innerHTML"],_hoisted_3={class:"working"},_hoisted_4={class:"coding"},_hoisted_5={class:"coding-top"},_hoisted_6=_withScopeId(()=>createBaseVNode("span",null,"代码",-1)),_hoisted_7={class:"coding-bottom"},_hoisted_8=_withScopeId(()=>createBaseVNode("span",null," 测试用例 ",-1)),_hoisted_9=_withScopeId(()=>createBaseVNode("span",null," 预期结果 ",-1)),_sfc_main={__name:"SingCompetitionArea",setup(__props){const socketStore=useSocketStore(),competitionStore=useCompetitionStore(),router=useRouter(),activeTab=ref("测试用例"),route=useRoute(),{scp}=route.params,runLoading=ref(!1),resultText=ref(""),content=ref(""),language=ref("python"),languageList={python:python(),cpp:cpp(),java:java(),go:go()},lang=ref(python()),codeVal=ref(""),result=ref(""),caseInput=ref(""),guessInput=ref(""),resultLoading=ref(!1),eltabs=ref("info"),time=ref(0),isFinished=ref(competitionStore.isFinished);socketStore.$subscribe((e,o)=>{console.log(o)});const togetProblemContent=()=>{getProblemContent(parseInt(scp)).then(e=>{console.log(e);try{const o=Object.keys(JSON.parse(e.data.data.inputSample)).join(",");codeVal.value=`def main(${o}):`}catch{codeVal.value="def main():"}content.value=e.data.data.description,caseInput.value=e.data.data.inputSample,guessInput.value=e.data.data.outputSample})},store=useUserStore(),runCode=()=>{runLoading.value=!0,resultLoading.value=!0,resultText.value="",isFinished.value?run(codeVal.value,store.userId,parseInt(scp)).then(function(e){runLoading.value=!1,resultLoading.value=!1,result.value=e.data.data,activeTab.value="运行结果",resultText.value=showResultFinished()}):(console.log("竞赛提交"),add(JSON.stringify({code:2,userId:store.userId,roomId:competitionStore.roomId,codeVal:codeVal.value,token:store.token,problemId:parseInt(scp)})))},showResult=()=>{const e=result.value;return e[3]===100?(startCheer(),"所有用例已通过"):`分数
${e[3]}
错误信息
${e[0].split("$").join(`
`)}
控制台输出
${e[2]}`},showResultFinished=()=>{const temp=eval(result.value);return temp[2]===0?(cheer(),"所有用例已通过"):transStatus(temp)+`
错误信息
${temp[1].split("$").join(`
`)}
控制台输出
${temp[3]}`},transStatus=r=>{const t=eval(r);switch(t[2]){case 0:return"正确";case 1:return"超出时间限制";case 2:return"运行错误";case 3:return"编译错误";case 4:return"答案错误"}return""},theme={".cm-content":{fontSize:"14px",fontFamily:'Consolas, "Courier New", monospace'}},leftClass=ref("content"),bottomClass=ref("result"),leftCloseButton=ref("closeButton"),bottomCloseButton=ref("closeButton"),changeLang=()=>{lang.value=languageList[language.value]},leftController=()=>{leftClass.value=="content"?(leftClass.value="content-close",leftCloseButton.value="closeButton-close"):(leftClass.value="content",leftCloseButton.value="closeButton")},bottomController=()=>{bottomClass.value=="result"?(bottomClass.value="result-close",bottomCloseButton.value="closeButton-close"):(bottomClass.value="result",bottomCloseButton.value="closeButton")},allController=()=>{leftClass.value=="content-close"&&bottomClass.value=="result-close"?(leftClass.value="content",bottomClass.value="result",leftCloseButton.value="closeButton",bottomCloseButton.value="closeButton"):(bottomClass.value="result-close",leftClass.value="content-close",bottomCloseButton.value="closeButton-close",leftCloseButton.value="closeButton-close")},langList=[{value:"python",label:"Python"},{value:"java",label:"Java"},{value:"cpp",label:"C++"},{value:"go",label:"Go"}],cheer=()=>{confetti({particleCount:500,angle:60,spread:90,startVelocity:70,ticks:300,gravity:1.2,origin:{x:0},colors:["#bd2332"]}),confetti({particleCount:500,angle:120,spread:90,ticks:300,gravity:1.2,startVelocity:70,origin:{x:1},colors:["#bd2332"]})};function startCheer(){var e=Date.now()+5e3;(function o(){confetti({particleCount:5,angle:60,spread:90,startVelocity:70,ticks:300,gravity:1.2,origin:{x:0}}),confetti({particleCount:5,angle:120,spread:90,ticks:300,gravity:1.2,startVelocity:70,origin:{x:1}}),Date.now()<e&&requestAnimationFrame(o)})()}const toExit=()=>{ElMessageBox.confirm("您确定要退出吗？（退出后将无法返回）","警告",{confirmButtonText:"退出",cancelButtonText:"取消",type:"warning"}).then(()=>{router.go(-1)})},getTime=()=>{let e=time.value,o=Math.floor(e/3600);e=e%3600;let n=Math.floor(e/60),a=e%60;return`${o} : ${n} : ${a}`};return togetProblemContent(),socketStore.$subscribe((e,o)=>{console.log(e,o);let n=JSON.parse(o.message);switch(n.code){case 2:n.point==100?(ElNotification({title:"注意",message:h("i",{style:"color: teal"},`对手已提交，取得了${n.point}分,比赛已经结束，但你仍然可以提交，提交将被视为普通的练习`),type:"warning",duration:0}),competitionStore.setis(!0)):ElNotification({title:"注意",message:h("i",{style:"color: teal"},`对手已提交，取得了${n.point}分`),type:"warning",duration:6e3}),cheer();break;case 3:console.log(n.result),console.log("收到结果"),runLoading.value=!1,resultLoading.value=!1,result.value=n.result,activeTab.value="运行结果",resultText.value=showResult();break;case 4:ElMessage.error("token失效，请重新登录")}}),store.userId===0&&store.token!==""&&getBaseInfo().then(e=>{store.setInformation(e.data.data)}),onMounted(()=>{setInterval(()=>{time.value++},1e3)}),(e,o)=>{const n=resolveComponent("Clock"),a=ElIcon,c=ElButton,m=ElHeader,v=ElScrollbar,d=ElTabPane,u=ElTabs,i=ElOption,p=ElSelect,f=ElInput,g=ElMain,y=ElContainer,b=vLoading;return openBlock(),createElementBlock("div",{class:"Header-Main-container",onKeydown:withKeys(withModifiers(()=>{},["prevent"]),["9","native"])},[createVNode(y,null,{default:withCtx(()=>[createVNode(m,{class:"elheader"},{default:withCtx(()=>[createVNode(a,{style:{"margin-right":"8px"}},{default:withCtx(()=>[createVNode(n)]),_:1}),createBaseVNode("div",null,toDisplayString(getTime()),1),createVNode(c,{type:"danger",plain:"",round:"",style:{position:"absolute",left:"32px"},onClick:o[0]||(o[0]=l=>toExit())},{default:withCtx(()=>[createTextVNode("退出")]),_:1})]),_:1}),createVNode(g,{class:"elmain"},{default:withCtx(()=>[createBaseVNode("div",{class:normalizeClass(leftClass.value)},[createVNode(u,{type:"card",class:"eltabs",modelValue:eltabs.value,"onUpdate:modelValue":o[1]||(o[1]=l=>eltabs.value=l)},{default:withCtx(()=>[createVNode(d,{label:"题目信息",class:"pane",name:"info"},{default:withCtx(()=>[createVNode(v,null,{default:withCtx(()=>[createBaseVNode("div",{innerHTML:content.value,style:{"overflow-y":"auto",height:"100%"}},null,8,_hoisted_2)]),_:1})]),_:1})]),_:1},8,["modelValue"]),createVNode(c,{class:normalizeClass(leftCloseButton.value),type:"info",icon:unref(arrow_left_bold_default),circle:"",style:{position:"absolute",top:"5px",right:"5px"},onClick:leftController},null,8,["class","icon"])],2),createBaseVNode("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[_hoisted_6,createBaseVNode("div",null,[createVNode(p,{modelValue:language.value,"onUpdate:modelValue":o[2]||(o[2]=l=>language.value=l),style:{width:"100px","margin-right":"8px"},change:changeLang()},{default:withCtx(()=>[(openBlock(),createElementBlock(Fragment,null,renderList(langList,l=>createVNode(i,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","change"]),createVNode(c,{class:"fullButton",icon:unref(full_screen_default),circle:"",onClick:allController},null,8,["icon"])])]),createVNode(unref(se),{basic:"",lang:lang.value,modelValue:codeVal.value,"onUpdate:modelValue":o[3]||(o[3]=l=>codeVal.value=l),style:{height:"0",flex:"1"},theme,tab:!0},null,8,["lang","modelValue"]),createBaseVNode("div",_hoisted_7,[createVNode(c,{class:"runButton",onClick:o[4]||(o[4]=l=>cheer())},{default:withCtx(()=>[createTextVNode("运行")]),_:1}),createVNode(c,{type:"success",onClick:runCode,loading:runLoading.value},{default:withCtx(()=>[createTextVNode("提交")]),_:1},8,["loading"])])]),createBaseVNode("div",{class:normalizeClass(bottomClass.value)},[createVNode(u,{type:"card",class:"eltabsResult",modelValue:activeTab.value,"onUpdate:modelValue":o[7]||(o[7]=l=>activeTab.value=l)},{default:withCtx(()=>[createVNode(d,{name:"测试用例",label:"测试用例",class:"paneResult"},{default:withCtx(()=>[_hoisted_8,createVNode(f,{modelValue:caseInput.value,"onUpdate:modelValue":o[5]||(o[5]=l=>caseInput.value=l),style:{width:"95%",margin:"8px 0"},placeholder:"测试用例",class:"elinput",type:"textarea",autosize:"",resize:"none"},null,8,["modelValue"]),_hoisted_9,createVNode(f,{modelValue:guessInput.value,"onUpdate:modelValue":o[6]||(o[6]=l=>guessInput.value=l),style:{width:"95%",margin:"8px 0"},placeholder:"预期结果",class:"elinput",type:"textarea",autosize:"",resize:"none"},null,8,["modelValue"])]),_:1}),withDirectives((openBlock(),createBlock(d,{name:"运行结果",label:"运行结果",class:"paneResult"},{default:withCtx(()=>[createTextVNode(toDisplayString(resultText.value),1)]),_:1})),[[b,resultLoading.value]])]),_:1},8,["modelValue"]),createVNode(c,{class:normalizeClass(bottomCloseButton.value),type:"info",icon:unref(arrow_down_bold_default),circle:"",style:{position:"absolute",top:"5px",right:"5px"},onClick:bottomController},null,8,["class","icon"])],2)])]),_:1})]),_:1})],40,_hoisted_1)}}},SingCompetitionArea=_export_sfc$1(_sfc_main,[["__scopeId","data-v-a31b1f23"]]);export{SingCompetitionArea as default};
